name: docs

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

on:
    workflow_dispatch:
    push:
        tags:
            - 'v*'

jobs:
    publish:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v4
                with:
                    fetch-depth: 0

            -   name: Set up Docker Buildx
                uses: docker/setup-buildx-action@v3

            -   name: Setup Deno
                uses: denoland/setup-deno@v2
                with:
                      deno-version: v2.x

            -   name: Install Dependencies
                run: deno i --allow-scripts

            -   name: Build
                run: deno task build

            -   name: Deploy
                uses: crazy-max/ghaction-github-pages@v4
                with:
                    target_branch: gh-pages
                    build_dir: ./build
                    jekyll: false
                    fqdn: https://lottie-to-webp.crec.dev
                env:
                    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}